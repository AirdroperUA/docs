---
id: gnss_developer_guide
title: –ü–æ—Å—ñ–±–Ω–∏–∫ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏ GNSS sanity board
sidebar_label: –î–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤
---

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —ñ–Ω–∂–µ–Ω–µ—Ä—ñ–≤, —è–∫—ñ –ø–ª–∞–Ω—É—é—Ç—å **–∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∞–±–æ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É** –¥–ª—è –ø–ª–∞—Ç–∏ **GNSS sanity board –Ω–∞ STM32F401**: –¥–æ–¥–∞–≤–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –Ω–æ–≤–∏—Ö GNSS-–ø—Ä–∏–π–º–∞—á—ñ–≤, –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ç—Ä–∏–≥–µ—Ä–∏ DR, —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥—ñ–≤ —Ç–æ—â–æ.

> üîÅ –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è —Å—Ö–µ–º–∏ ‚Äú—Ä–æ–∑—Ä–æ–±–Ω–∏–∫ ‚Üî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π ‚Üî –ø–ª–∞—Ç–∞‚Äù  
> `![–°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—É —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ—à–∏–≤–∫–∏](pathname://IMAGE_URL_DEV_WORKFLOW)`

---

## 1. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—à–∏–≤–∫–∏

–†–µ–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –º–æ–∂–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è, –∞–ª–µ —Ç–∏–ø–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:

```text
firmware/
  ‚îú‚îÄ src/
  ‚îÇ   ‚îú‚îÄ main.cpp / main.ino
  ‚îÇ   ‚îú‚îÄ gnss_parser.cpp / gnss_parser.h    # –ø–∞—Ä—Å–µ—Ä GNSS (UBX/NMEA)
  ‚îÇ   ‚îú‚îÄ dr_logic.cpp / dr_logic.h          # –ª–æ–≥—ñ–∫–∞ DR / –∞–Ω—Ç–∏-—Å–ø—É—Ñ—ñ–Ω–≥
  ‚îÇ   ‚îú‚îÄ mavlink_if.cpp / mavlink_if.h      # –≤–∏—Ö—ñ–¥ —É MAVLink
  ‚îÇ   ‚îî‚îÄ config.h                           # —É—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏
  ‚îú‚îÄ lib/
  ‚îÇ   ‚îú‚îÄ mavlink/                           # –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π MAVLink ardupilotmega
  ‚îÇ   ‚îî‚îÄ TinyGPS++ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
  ‚îú‚îÄ platformio.ini                         # –¥–ª—è PlatformIO (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  ‚îî‚îÄ README.md
```

–û—Å–Ω–æ–≤–Ω—ñ –º–æ–¥—É–ª—ñ:

- `gnss_parser.*` ‚Äî —Ä–æ–∑–±—ñ—Ä UBX/NMEA —Ç–∞ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è ‚Äú—á–∏—Å—Ç–∏—Ö‚Äù –∑–Ω–∞—á–µ–Ω—å `lat/lon/alt/sats/hdop/vel`.
- `dr_logic.*` ‚Äî —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –∞–Ω—Ç–∏-—Å–ø—É—Ñ—ñ–Ω–≥—É —Ç–∞ —Ä–µ–∂–∏–º—É DR (DR0/DR1).
- `mavlink_if.*` ‚Äî –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è MAVLink-–ø–∞–∫–µ—Ç—ñ–≤ (`GPS_INPUT` / `HIL_GPS`, `STATUSTEXT`).
- `config.h` ‚Äî –ø–æ—Ä–æ–≥–∏, `SYSID`/`COMPID`, —à–≤–∏–¥–∫–æ—Å—Ç—ñ UART, —Ä–µ–∂–∏–º–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–æ—â–æ.

---

## 2. –°–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ä–æ–∑—Ä–æ–±–∫–∏

### 2.1. Arduino IDE (–ø—Ä–æ—Å—Ç–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

- –ü–ª–∞—Ç–∞: `Generic STM32F4` / `Black Pill F401` (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ core).
- –¢–∞–∫—Ç–æ–≤–∞ —á–∞—Å—Ç–æ—Ç–∞: 84 –ú–ì—Ü (—Ç–∏–ø–æ–≤–æ –¥–ª—è STM32F401).
- –°–µ—Ä—ñ–π–Ω—ñ –ø–æ—Ä—Ç–∏:
  - `Serial` ‚Äî USB (debug-–ª–æ–≥).
  - `Serial1` ‚Äî UART –¥–æ –∞–≤—Ç–æ–ø—ñ–ª–æ—Ç–∞ (MAVLink).
  - –æ–∫—Ä–µ–º–∏–π `HardwareSerial` / `UART` –¥–ª—è GNSS (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Serial2`).

–ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏:

- **MAVLink** ‚Äî –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –Ω–∞–±—ñ—Ä –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –¥–ª—è `ardupilotmega`:

  ```cpp
  #include <mavlink/mavlink/ardupilotmega/mavlink.h>
  ```

- **–ü–∞—Ä—Å–µ—Ä GNSS**:
  - `TinyGPS++` –¥–ª—è NMEA **–∞–±–æ**
  - –≤–ª–∞—Å–Ω–∏–π –ø–∞—Ä—Å–µ—Ä UBX/NMEA (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è F10N/F9P).

---

### 2.2. PlatformIO (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

–ü—Ä–∏–∫–ª–∞–¥ `platformio.ini`:

```ini
[env:blackpill_f401cc]
platform        = ststm32
board           = blackpill_f401cc
framework       = arduino
upload_protocol = stlink
monitor_speed   = 115200
```

–ü–µ—Ä–µ–≤–∞–≥–∏:

- –ø—Ä–æ—Å—Ç–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ (`lib_deps`);
- –æ–∫—Ä–µ–º—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –∑–±—ñ—Ä–∫–∏ (debug / release) –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ—î–∫—Ç—ñ;
- –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ –∑–±—ñ—Ä–∫–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –ø–ª–∞—Ç / –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π.

---

## 3. –ö–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ `config.h`

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –º–∞—Ç–∏ **—î–¥–∏–Ω–∏–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó**, –¥–µ –∑—ñ–±—Ä–∞–Ω—ñ –≤—Å—ñ ‚Äú—Ä—É—á–∫–∏‚Äù, —è–∫—ñ –≤–∏ –∑–º—ñ–Ω—é—î—Ç–µ —á–∞—Å—Ç—ñ—à–µ –∑–∞ —ñ–Ω—à—ñ.

### 3.1. UART —Ç–∞ —à–≤–∏–¥–∫–æ—Å—Ç—ñ

```cpp
// UART –¥–æ GNSS-–ø—Ä–∏–π–º–∞—á–∞
static const uint32_t GNSS_BAUD = 115200;

// UART –¥–æ –∞–≤—Ç–æ–ø—ñ–ª–æ—Ç–∞ (MAVLink)
static const uint32_t FC_BAUD   = 115200;

// USB –¥–ª—è –ª–æ–≥—ñ–≤
static const uint32_t USB_BAUD  = 115200;

// –í–∏–±—ñ—Ä –∞–ø–∞—Ä–∞—Ç–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤ (–ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è STM32F401)
#define GNSS_SERIAL   Serial2
#define FC_SERIAL     Serial1
#define USB_SERIAL    Serial
```

### 3.2. –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ MAVLink

```cpp
static const uint8_t MY_SYSID  = 42;
static const uint8_t MY_COMPID = MAV_COMP_ID_ONBOARD_COMPUTER;

static const uint8_t FC_SYSID  = 1;
static const uint8_t FC_COMPID = MAV_COMP_ID_AUTOPILOT1;
```

> –Ø–∫—â–æ –≤ ArduPilot –∑–º—ñ–Ω–µ–Ω–æ `SYSID_THISMAV`, –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ `FC_SYSID` —É –ø—Ä–æ—à–∏–≤—Ü—ñ –ø–ª–∞—Ç–∏.

### 3.3. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–Ω—Ç–∏-—Å–ø—É—Ñ—ñ–Ω–≥—É (–ø—Ä–∏–∫–ª–∞–¥)

```cpp
// –°—Ç—Ä–∏–±–∫–∏ –≤—ñ–¥—Å—Ç–∞–Ω—ñ / —à–≤–∏–¥–∫–æ—Å—Ç—ñ
static const float   GNSS_MAX_DIST_JUMP_M = 200.0f;
static const float   GNSS_MAX_SPEED_JUMP  = 150.0f;
static const float   GNSS_MAX_SPEED_MPS   = 120.0f;
static const float   GNSS_MAX_ALT_JUMP_M  = 100.0f;

// –Ø–∫—ñ—Å—Ç—å GNSS
static const uint16_t GNSS_MIN_SATS_FIX   = 6;
static const uint16_t GNSS_MIN_SATS_GOOD  = 12;
static const float    GNSS_MAX_HDOP_GOOD  = 2.0f;

// –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Ç–µ–ª–µ–ø–æ—Ä—Ç—É –≤ –ü—ñ–≤–¥–µ–Ω–Ω—É –ø—ñ–≤–∫—É–ª—é
static const bool GNSS_SOUTH_HEMI_PROTECT = true;

// –¢–∞–π–º—ñ–Ω–≥–∏
static const uint32_t GNSS_FIX_TIMEOUT_MS = 10000;
static const uint32_t DR_ENTER_MIN_BAD_MS = 3000;
static const uint32_t DR_EXIT_MIN_GOOD_MS = 5000;
```

–ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ü–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –Ω–∞–≤–µ–¥–µ–Ω–∏–π —É —Ä–æ–∑–¥—ñ–ª—ñ `gnss_code_params.md`.

---

## 4. –ó–º—ñ–Ω–∞ –ø–æ—Ä–æ–≥—ñ–≤ DR-–ª–æ–≥—ñ–∫–∏

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `config.h` (–∞–±–æ —Ñ–∞–π–ª, –¥–µ –æ–≥–æ–ª–æ—à–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏).
2. –ó–º—ñ–Ω—ñ—Ç—å –ø–æ—Ä–æ–≥–∏, —Å–ø–∏—Ä–∞—é—á–∏—Å—å –Ω–∞:
   - —Ä–µ–∞–ª—å–Ω—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —à–≤–∏–¥–∫—ñ—Å—Ç—å / –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ UAV;
   - —Ç–∏–ø–æ–≤—ñ —É–º–æ–≤–∏ –ø–æ–ª—å–æ—Ç—ñ–≤ (–≤–∏—Å–æ—Ç–∞, –ø—Ä–æ—Ñ—ñ–ª—å –º–∞—Ä—à—Ä—É—Ç—É, —Ä—ñ–∑–∫—ñ—Å—Ç—å –º–∞–Ω–µ–≤—Ä—ñ–≤).
3. –ü–µ—Ä–µ–∑–±–µ—Ä—ñ—Ç—å –ø—Ä–æ—à–∏–≤–∫—É.
4. –í–∏–∫–æ–Ω–∞–π—Ç–µ **lab-—Ç–µ—Å—Ç–∏** (–¥–∏–≤. `gnss_testing.md`), –∞ –ø–æ—Ç—ñ–º **–∫–æ—Ä–æ—Ç–∫–∏–π –ø–æ–ª—å–æ–≤–∏–π —Ç–µ—Å—Ç**.
5. –Ø–∫—â–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —á–∞—Å—Ç—ñ —Ö–∏–±–Ω—ñ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–Ω–Ω—è DR:
   - –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å –ø–æ—Ä–æ–≥–∏ –±–ª–∏–∂—á–µ –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å;
   - –∑–º—ñ–Ω—é–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–µ–≤–µ–ª–∏–∫–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏ –π –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ —Ñ—ñ–∫—Å—É–π—Ç–µ, –∑ —è–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –≤–∏–∫–æ–Ω—É–≤–∞–ª–∏—Å—è —Ç–µ—Å—Ç–∏.

---

## 5. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –Ω–æ–≤–æ–≥–æ GNSS-–ø—Ä–∏–π–º–∞—á–∞

### 5.1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª

1. –ó º—è—Å—É–π—Ç–µ, —è–∫—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ –ø—ñ–¥—Ç—Ä–∏–º—É—î –º–æ–¥—É–ª—å:
   - UBX, NMEA –∞–±–æ –≤–ª–∞—Å–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª.
2. –í–∏–∑–Ω–∞—á—Ç–µ, –≤ —è–∫–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö –º—ñ—Å—Ç—è—Ç—å—Å—è:
   - —à–∏—Ä–æ—Ç–∞, –¥–æ–≤–≥–æ—Ç–∞, –≤–∏—Å–æ—Ç–∞;
   - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—É–ø—É—Ç–Ω–∏–∫—ñ–≤;
   - HDOP / VDOP;
   - —à–≤–∏–¥–∫—ñ—Å—Ç—å / –∫—É—Ä—Å;
   - —á–∞—Å (week, tow).

### 5.2. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –ø–∞—Ä—Å–µ—Ä

–£ –º–æ–¥—É–ª—ñ `gnss_parser.*` —Ä–µ–∞–ª—ñ–∑—É–π—Ç–µ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–±–ª–∏–∑–Ω–æ —Ç–∞–∫–æ–≥–æ –≤–∏–≥–ª—è–¥—É:

```cpp
// –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –Ω–∞ –∫–æ–∂–µ–Ω –±–∞–π—Ç –∑ GNSS UART
bool    gnss_parse_byte(uint8_t b);

// –°—Ç–∞—Ç—É—Å —Ç–∞ –¥–∞–Ω—ñ
bool    gnss_has_fix();
uint8_t gnss_fix_type();
float   gnss_lat_deg();
float   gnss_lon_deg();
float   gnss_alt_m();
uint8_t gnss_sats();
float   gnss_hdop();
float   gnss_speed_mps();
float   gnss_course_deg();
```

–£ –≥–æ–ª–æ–≤–Ω–æ–º—É —Ü–∏–∫–ª—ñ (`loop()` / `main()`):

```cpp
void loop() {
    while (GNSS_SERIAL.available()) {
        uint8_t b = GNSS_SERIAL.read();
        gnss_parse_byte(b);
    }

    update_dr_and_publish(); // DR-–ª–æ–≥—ñ–∫–∞ + –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ MAVLink
}
```

### 5.3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–∞—Ä—Å–µ—Ä

- –ù–∞ —Å—Ç–æ–ª—ñ –∑ —Ä–µ–∞–ª—å–Ω–æ—é –∞–Ω—Ç–µ–Ω–æ—é:
  - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ `lat/lon/alt/sats/hdop` –≤–∏–≥–ª—è–¥–∞—é—Ç—å –∞–¥–µ–∫–≤–∞—Ç–Ω–æ;
  - –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `gnss_has_fix()` –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å —É —Å—Ç–∞–Ω fix (2D/3D).
- –ó–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∑–∞–ø–∏—Å–∞–Ω–∏–π –ª–æ–≥ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `.ubx`), —è–∫–∏–π –ø—Ä–æ–≥—Ä–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ UART –¥–ª—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤.

---

## 6. –§–æ—Ä–º—É–≤–∞–Ω–Ω—è MAVLink-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

–£ –º–æ–¥—É–ª—ñ `mavlink_if.*` –∑–∞–∑–≤–∏—á–∞–π —î —Ñ—É–Ω–∫—Ü—ñ—ó:

```cpp
void send_gps_to_fc();                 // —Ñ–æ—Ä–º—É—î GPS_INPUT / HIL_GPS
void send_status_text(uint8_t sev, const char *fmt, ...);
```

### 6.1. –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `GPS_INPUT`

```cpp
void send_gps_to_fc() {
    if (!gnss_has_fix()) {
        return;
    }

    mavlink_gps_input_t gps{};
    gps.time_usec       = micros64();
    gps.gps_id          = 0;
    gps.ignore_flags    = 0;
    gps.time_week       = week;
    gps.time_week_ms    = tow_ms;
    gps.fix_type        = gnss_fix_type();
    gps.lat             = (int32_t)(gnss_lat_deg() * 1e7);
    gps.lon             = (int32_t)(gnss_lon_deg() * 1e7);
    gps.alt             = gnss_alt_m();
    gps.vn              = vel_n;
    gps.ve              = vel_e;
    gps.vd              = vel_d;
    gps.hdop            = gnss_hdop();
    gps.vdop            = 0.0f;
    gps.yaw             = gnss_course_deg() * 100.0f;
    gps.satellites_used = gnss_sats();

    mavlink_message_t msg;
    mavlink_msg_gps_input_pack(
        MY_SYSID,
        MY_COMPID,
        &msg,
        FC_SYSID,
        FC_COMPID,
        &gps
    );
    send_mavlink_to_fc(msg);
}
```

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `HIL_GPS`, –¥–æ—Å—Ç–∞—Ç–Ω—å–æ:

1. –ó–∞–º—ñ–Ω–∏—Ç–∏ —Ç–∏–ø —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (`mavlink_hil_gps_t`) —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—é `mavlink_msg_hil_gps_pack`.
2. –ö–æ—Ä–µ–∫—Ç–Ω–æ –∑–º–µ–ø–∏—Ç–∏ –ø–æ–ª—è (–¥–∏–≤. –∑–∞–≥–æ–ª–æ–≤–∫–∏ MAVLink –¥–ª—è `HIL_GPS`).

---

## 7. –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ debug

### 7.1. –ú–∞–∫—Ä–æ—Å–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è

```cpp
#define LOGF(fmt, ...)  do { USB_SERIAL.printf(fmt "\r\n", ##__VA_ARGS__); } while (0)
#define LOG(msg)        do { USB_SERIAL.println(msg); } while (0)
```

–û–±–≥–æ—Ä—Ç–∫–∏ –¥–ª—è `STATUSTEXT`:

```cpp
void status_info (const char *fmt, ...);
void status_warn (const char *fmt, ...);
void status_error(const char *fmt, ...);
```

–¶–µ –¥–æ–∑–≤–æ–ª—è—î:

- –≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤–∏–π –ª–æ–≥ –ø–æ USB;
- –¥—É–±–ª—é–≤–∞—Ç–∏ –∫–ª—é—á–æ–≤—ñ –ø–æ–¥—ñ—ó (`ENTER DR`, `EXIT DR`, —Å–ø—É—Ñ—ñ–Ω–≥) —É GCS —á–µ—Ä–µ–∑ `STATUSTEXT`.

### 7.2. –†–µ–∂–∏–º–∏ DEBUG / RELEASE

```cpp
//#define DEBUG_BUILD

#ifdef DEBUG_BUILD
static const bool kDebugLogsEnabled = true;
#else
static const bool kDebugLogsEnabled = false;
#endif
```

```cpp
if (kDebugLogsEnabled) {
    LOGF("DBG: raw gnss lat=%.7f lon=%.7f hdop=%.2f", lat, lon, hdop);
}
```

–£ —Ä–µ–ª—ñ–∑–Ω–∏—Ö –∑–±—ñ—Ä–∫–∞—Ö –±–∞–∂–∞–Ω–æ –≤–∏–º–∏–∫–∞—Ç–∏ –∑–∞–π–≤—ñ debug-–ª–æ–≥–∏, —â–æ–± –Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ UART —ñ MCU.

---

## 8. –ö–æ–¥-—Å—Ç–∏–ª—å —Ç–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –∑–º—ñ–Ω

1. **–†–æ–∑–¥—ñ–ª—è–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –ø–æ –º–æ–¥—É–ª—è—Ö.**  
   –ü–∞—Ä—Å–µ—Ä GNSS, DR-–ª–æ–≥—ñ–∫–∞, MAVLink-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —ñ `main` –º–∞—é—Ç—å –±—É—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º–∏.

2. **–î–æ–∫—É–º–µ–Ω—Ç—É–π—Ç–µ –∫–ª—é—á–æ–≤—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏.**  
   –ù–∞–¥ –∫–æ–∂–Ω–∏–º –ø–æ—Ä–æ–≥–æ–º —É `config.h` –∑–∞–ª–∏—à–∞–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä, —â–æ –≤—ñ–Ω –æ–∑–Ω–∞—á–∞—î —Ç–∞ –¥–ª—è —è–∫–æ–≥–æ –∫–ª–∞—Å—É UAV –ø—ñ–¥—ñ–±—Ä–∞–Ω–∏–π.

3. **–í–∏–Ω–æ—Å—å—Ç–µ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ñ —Ä–µ—á—ñ –≤ `#ifdef`.**

   ```cpp
   #ifdef EXPERIMENTAL_FEATURE_X
   // –Ω–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ DR
   #endif
   ```

4. **–û–Ω–æ–≤–ª—é–π—Ç–µ changelog.**  
   –ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ–ª—ñ–∑—É / —Å—É—Ç—Ç—î–≤–æ—ó –∑–º—ñ–Ω–∏ –¥–æ–¥–∞–≤–∞–π—Ç–µ –∑–∞–ø–∏—Å —É `gnss_changelog.md`.

---

## 9. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Ä–æ–∑—Ä–æ–±–∫–∏

1. **–ó–º—ñ–Ω–∏ –≤ –∫–æ–¥—ñ**
   - –≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ `config.h` / –ø–æ—Ç—Ä—ñ–±–Ω—ñ –º–æ–¥—É–ª—ñ;
   - –∑–±—ñ–ª–¥–∏—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É –ø—ñ–¥ —Ü—ñ–ª—å–æ–≤—É –ø–ª–∞—Ç—É.

2. **Lab-—Ç–µ—Å—Ç–∏**
   - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ —Ä–µ–∞–ª—å–Ω–∏–º GNSS –Ω–∞ —Å—Ç–æ–ª—ñ:
     - LED, DR0/DR1;
     - USB-–ª–æ–≥–∏ (—á–∏ –Ω–µ–º–∞—î –¥–∏–≤–Ω–∏—Ö —Å—Ç—Ä–∏–±–∫—ñ–≤ / –ø–∞–¥—ñ–Ω—å fix).
   - –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤—Ç—Ä–∞—Ç–∏ GNSS —ñ –≥—Ä—É–±–æ–≥–æ —Å–ø—É—Ñ—ñ–Ω–≥—É.

3. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –∑ –∞–≤—Ç–æ–ø—ñ–ª–æ—Ç–æ–º**
   - –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ MAVLink-–ø–∞–∫–µ—Ç–∏ –¥–æ—Ö–æ–¥—è—Ç—å –¥–æ ArduPilot (MAVLink Inspector);
   - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `GPS_TYPE` / `GPS_TYPE2`.

4. **–ü–æ–ª—å–æ–≤—ñ —Ç–µ—Å—Ç–∏**
   - –∫–æ—Ä–æ—Ç–∫—ñ –ø–æ–ª—å–æ—Ç–∏ –≤ –±–µ–∑–ø–µ—á–Ω–∏—Ö —É–º–æ–≤–∞—Ö;
   - –∞–Ω–∞–ª—ñ–∑ `.bin`-–ª–æ–≥—ñ–≤ –∞–≤—Ç–æ–ø—ñ–ª–æ—Ç–∞ —Ä–∞–∑–æ–º —ñ–∑ USB-–ª–æ–≥–∞–º–∏ –ø–ª–∞—Ç–∏.

5. **–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è**
   - –æ–Ω–æ–≤–∏—Ç–∏ `gnss_changelog.md`;
   - –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –ø—É–Ω–∫—Ç–∏ –≤ `gnss_faq.md` —Ç–∞ —ñ–Ω—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó.

---

–ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—à–∏–≤–∫–∏ —Ç–∞ –∞–∫—É—Ä–∞—Ç–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Ä–æ–∑—Ä–æ–±–∫–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –±–µ–∑–ø–µ—á–Ω–æ —Ä–æ–∑–≤–∏–≤–∞—Ç–∏ GNSS sanity board, –¥–æ–¥–∞—é—á–∏ –Ω–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤ –ø–æ–ª—å–æ—Ç—ñ.
