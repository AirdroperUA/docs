---
id: gnss_hardware
title: Огляд заліза плати GNSS sanity board
sidebar_label: Огляд заліза
---

Ця сторінка описує апаратну частину плати **GNSS sanity board на STM32F401**, яка використовується як анти-спуфінг модуль для GNSS-приймачів (F10N/F9P/інші) з виходом GPS через MAVLink.

## 1. Призначення плати

Плата виконує роль “розумного фільтра” між GNSS-приймачем та автопілотом:

- приймає сирі дані GNSS по UART (NMEA/UBX);
- аналізує якість сигналу та виявляє аномалії;
- у разі підозри переходить у **Dead Reckoning (DR)** і не дає автопілоту прийняти фейкові координати;
- віддає у автопілот **GPS через MAVLink (GPS_TYPE = MAV)**.

Типовий ланцюжок:

~~~text
GNSS-приймач → GNSS sanity board (STM32F401) → MAVLink по UART → автопілот (ArduPilot / ArduPlane)
~~~

## 2. Основні компоненти

- **Мікроконтролер:** STM32F401 (лінійка “Black Pill” або власний дизайн).
- **Тактова частота MCU:** до 84 МГц.
- **Інтерфейси:**
  - UART до GNSS-приймача;
  - UART до автопілота (MAVLink);
  - USB (debug / логи);
  - GPIO для LED-індикації, за потреби — додаткові входи/виходи.
- **Живлення:** 5 В (типово від BEC або 5 V рейки автопілота).
- **Рівні сигналів UART:** 3.3 В.

 Фото плати зверху:

 ![Плата GNSS sanity board (вид зверху)](https://i.imgur.com/XpNyuYL.jpeg)

## 3. Пін-аут плати

Нижче — типовий пін-аут, орієнтований на Black Pill STM32F401 (його можна адаптувати під вашу конкретну ревізію):

### 3.1. Живлення

| Пін / розʼєм | Сигнал | Опис                                     |
|--------------|--------|------------------------------------------|
| `5V` / `VIN` | 5 В    | Живлення плати (від BEC або FC)          |
| `GND`        | GND    | Загальна земля (спільна з GNSS та FC)    |

### 3.2. UART до GNSS-приймача

| Пін MCU | Назва на платі | Напрямок    | Підключення                    |
|---------|----------------|-------------|--------------------------------|
| `A3`   | `GPS_RX`       | RX MCU      | До `TX` GNSS-приймача         |
| `A2`   | `GPS_TX`       | TX MCU      | До `RX` GNSS-приймача (опц.)  |
| `GND`   | `GND`          | —           | До `GND` GNSS-приймача        |

> Якщо прошивка не конфігурує GNSS-приймач по UART, пін `GPS_TX` можна не підключати.

### 3.3. UART до автопілота (MAVLink)

| Пін MCU | Назва на платі | Напрямок           | Підключення до FC                  |
|---------|----------------|--------------------|------------------------------------|
| `A9`   | `FC_TX`        | TX MCU → RX FC     | До `SERIALx_RX` автопілота        |
| `A10`  | `FC_RX`        | RX MCU ← TX FC     | До `SERIALx_TX` автопілота (опц.) |
| `GND`   | `GND`          | —                  | До `GND` автопілота               |
| `5V`    | `5V`           | Вхід 5 В (опц.)    | До 5 V рейки автопілота           |

**Мінімальний варіант:** достатньо підключити `FC_TX (A9)` і `GND` — тоді плата зможе віддавати GPS по MAVLink, але не читатиме heartbeat/параметри від FC.

### 3.4. USB (debug)

| Елемент          | Опис                                           |
|-----------------|------------------------------------------------|
| USB-C / microUSB| Підключення до ПК для логів через `USB_SERIAL` |

Через USB ти бачиш текстові логи виду:

~~~text
fix=3 s=18 hd=0.9 sp=0.0 crs=0.0 alt=176.3 DR0
Latitude : 52.000100
Longitude: 33.000801
~~~

### 3.5. LED-індикація

| Пін MCU | Опис                            |
|---------|---------------------------------|
| `PC13`  | Вбудований LED, індикація стану |

Типова логіка:

- повільне миготіння — нормальний режим (`DR0`);
- швидке миготіння — підозрілий GNSS / активний `DR1`;
- відсутність світіння при наявності живлення — MCU не стартував/немає прошивки.

Фото з підписаними пін-аутами:

![Пін-аут плати GNSS sanity board](https://i.imgur.com/Cw9dWvN.png)

## 4. Електричні характеристики


| Параметр                      | Типове значення              |
|-------------------------------|------------------------------|
| Напруга живлення             | 5 В (мін. 4.5, макс. 5.5 В) |
| Споживаний струм (робота)    | ~40–80 мА (без GNSS)         |
| Рівні UART                   | 3.3 В                        |
| Робоча температура           | -20…+60 °C                   |

Рекомендації:

- живити плату від **стабільного BEC** або 5 V рейки автопілота;
- не перевищувати 5.5 В на вході;
- уникати довгих “земляних петель” між GNSS, платою та FC — бажано, щоб усі вони мали спільний GND поблизу.

## 5. Монтаж у фюзеляжі

- Плату бажано розміщувати:
  - подалі від потужних RF-передавачів (VTX, LTE, Starlink-антена);
  - подалі від силового проводу моторів/регулятора (мінімізуємо наводки).
- Бажано мати:
  - кріплення на гумових втулках або пін-подібну ізоляцію від вібрацій;
  - мінімальну довжину проводів UART до GNSS та FC.

## 6. Сумісність з GNSS-приймачами та автопілотами

Плата орієнтована на:

- GNSS-модулі з UART-виходом (F10N, F9P, M10, UM980, інші);
- автопілоти з підтримкою ArduPilot/ArduPlane, які вміють приймати GPS по MAVLink (`GPS_TYPE = MAV`).

Для нового GNSS-приймача зазвичай потрібно:

1. Налаштувати правильний baud rate (наприклад, 115200) і формат (UBX/NMEA).
2. Переконатися, що прошивка плати коректно парсить потрібні повідомлення (NAV-PVT / GxGGA тощо).
3. Відкоригувати пороги якості GNSS у прошивці (див. розділ “Параметри прошивки”).

