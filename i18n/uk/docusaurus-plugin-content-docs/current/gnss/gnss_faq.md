---
id: gnss_faq
title: Часті запитання (FAQ) по GNSS sanity board
sidebar_label: FAQ / Відомі проблеми
---

На цій сторінці зібрані типові запитання та відомі проблеми, які можуть виникати при роботі з **GNSS sanity board на STM32F401**.

---

## 1. Плата не подає ознак життя, LED не блимає

**Симптоми:**

- після подачі 5 В LED взагалі не світиться;
- по USB немає жодних логів;
- GNSS та автопілот не бачать GPS.

**Перевірте:**

1. Напругу живлення:
   - між `5V/VIN` та `GND` має бути ~5 В;
   - полярність не переплутана.
2. Чи правильно встановлена/прошита плата STM32F401:
   - чи завантажено правильний `.bin`;
   - чи не пошкоджено бутлоадер.
3. Чи не замкнуті випадково лінії або не пошкоджені доріжки.

Якщо напруга є, але LED не подає ознак життя — найімовірніше, проблема у прошивці або самому MCU.

---

## 2. LED блимає, але в Mission Planner немає GPS

**Симптоми:**

- плата явно працює (LED блимає, по USB є логи);
- ArduPilot не показує GPS (`gpsstatus = 0`, немає координат).

**Можливі причини:**

1. Неправильний порт або протокол:

   - перевірте, що використовуєте **той самий порт**, куди підключена плата:
     - `SERIALx_PROTOCOL = 2` (або `1` для MAVLink1);
     - `SERIALx_BAUD = 115` (або інша погоджена швидкість).

2. Неправильний тип GPS:

   - для плати потрібно:

     ```text
     GPS_TYPE  = 14      # або GPS_TYPE2 = 14, якщо це другий GPS
     ```

3. Плата в DR і не надсилає координати:

   - перевірте USB-логи — чи немає `DR1` і `GPS: ENTER DR`.

4. SYSID автопілота не збігається з `FC_SYSID` у прошивці:

   - якщо ви змінювали `SYSID_THISMAV` в ArduPilot, потрібно відповідно змінити `FC_SYSID` у коді.

---

## 3. В Mission Planner GPS час від часу зникає або “підвисає”

**Симптоми:**

- координати довго не оновлюються;
- іноді `gpsstatus` стає 0;
- при цьому плата в логах показує `DR1`.

**Що це означає:**

- плата **свідомо перестає оновлювати координати** або переводить GPS у DR, оскільки:
  - виявлено стрибок координат/швидкості;
  - погіршилася якість GNSS;
  - був тривалий час без валідного fix.

**Що робити:**

1. Переглянути USB-логи — які саме тригери DR спрацювали.
2. Переконатися, що пороги настроєні під ваш UAV:
   - `GNSS_MAX_DIST_JUMP_M`;
   - `GNSS_MAX_SPEED_MPS`;
   - `GNSS_MAX_HDOP_GOOD` тощо.
3. За потреби — трохи послабити пороги (але не занадто), перепрошити плату та повторити тести.

---

## 4. Плата завжди у DR (DR1), навіть на землі при нормальному GNSS

**Симптоми:**

- у логах постійно `DR1`;
- LED весь час у “alarm”-режимі;
- `GPS: ENTER DR` зʼявляється відразу після старту.

**Можливі причини:**

1. GNSS не видає нормальних даних:
   - неправильна конфігурація (не увімкнені потрібні UBX/NMEA повідомлення);
   - погана антена / поганий прийом (мало супутників, великий HDOP).

2. Занадто жорсткі пороги в прошивці:
   - `GNSS_MIN_SATS_FIX` > фактичної кількості супутників;
   - `GNSS_MAX_HDOP_GOOD` занадто малий (реальний HDOP не проходить поріг);
   - `GNSS_FIX_TIMEOUT_MS` надто малий.

3. Невірно обробляються дані з конкретного типу GNSS (наприклад, новий модуль, якого не було в початковому коді).

**Рішення:**

- перевірити USB-логи — що саме вважається “поганим”;
- тимчасово записати ще більше діагностичних повідомлень;
- адаптувати парсер та пороги під свій модуль.

---

## 5. У логах раптово видно координати іншого континенту / півкулі

**Симптоми:**

- плата показує, наприклад, `Latitude/Longitude` десь у Південній Америці чи Австралії, хоча UAV знаходиться в іншому регіоні;
- при цьому зʼявляється `SPOOF: SOUTH HEMI JUMP` та `GPS: ENTER DR`.

**Що це означає:**

- плата виявила різкий перехід у іншу півкулю / дуже далекий регіон;
- це вважається **спуфінгом** або критичною помилкою GNSS;
- система переходить у DR і блокує подальше використання таких координат.

**Рекомендація:**

- перевірити джерело GNSS:
  - чи немає поблизу спуферів / тестових генераторів;
  - чи не використовуєте ви GPS-симуляцію (HackRF/gps-sdr-sim) на тому ж стенді.
- перевірити, чи не переплутані в коді формати/одиниці координат.

---

## 6. Як зрозуміти, чому саме плата увійшла в DR?

Ваш базовий інструментарій:

1. **USB-логи плати:**
   - текстові повідомлення `SPOOF: ...`, `GPS: ENTER DR (...)`, `GPS: EXIT DR`;
   - поточні значення `fix`, `sats`, `hd`, `sp`, `DR0/DR1`.

2. **STATUSTEXT в Mission Planner:**
   - ті ж повідомлення, але в інтерфейсі GCS.

3. **Параметри/пороги в коді:**
   - подивіться в розділ з параметрами прошивки (`gnss_code_params.md`) — які пороги встановлені.

Алгоритм:

1. Знайдіть момент входу в DR (`GPS: ENTER DR`).
2. Подивіться на кілька рядків перед ним:
   - що сталося з `fix`, `sats`, `hd`, `lat/lon`, швидкістю.
3. Співвіднесіть з порогами в прошивці — який саме тригер міг спрацювати.

---

## 7. Чи можна використовувати плату як єдиний GPS без резерву?

**Технічно — так**, але є нюанси:

- при спуфінгу / поганому GNSS плата перейде в DR і **відріже координати**;
- автопілот у такому випадку залишиться без GPS і перейде в режим “без супутників” (лише INS/баро).

**Рекомендація:**

- якщо місія критична, краще мати **друге джерело навігації**:
  - другий GNSS (іншого типу / іншого провайдера);
  - потужний INS;
  - візуальні сенсори.

Плата оптимальна як **фільтрований основний GPS** плюс резервний “чистий” GPS або інші сенсори.

---

## 8. Чи потрібне окреме калібрування для плати?

Для самої плати **калібрування не потрібне**:

- вона лише аналізує потік GNSS-даних та порівнює їх з фізичними порогами.

Однак:

- автопілот все одно потребує стандартного калібрування:
  - компас;
  - IMU/акселерометри;
  - повітряна швидкість;
  - RC/моделі.

Також варто:

- провести **тести в реальних умовах** для підбору порогів (див. розділи *Тестування* та *Модель загроз*).

---

## 9. Як оновити прошивку на платі?

Загальна схема:

1. Зібрати нову прошивку (Arduino / PlatformIO / інше середовище).
2. Підключити ST-LINK / USB bootloader (залежно від вашого варіанту плати).
3. Прошити `.bin` у STM32F401.
4. Перевірити, що:
   - плата стартує (LED блимає);
   - по USB є логи;
   - при підключенні до автопілота MAVLink-пакети приходять.

> Детальна інструкція з прошивки може бути винесена в окремий документ (якщо ви плануєте віддавати плату третім сторонам для самостійного оновлення).

---

## 10. Що робити, якщо виявлено баг у прошивці?

Рекомендована дія:

1. Зафіксувати:
   - версію прошивки (див. `gnss_changelog.md`);
   - умови тесту (lab/field);
   - USB-лог;
   - лог автопілота (`.bin` / `tlog`).
2. Описати:
   - очікувану поведінку;
   - фактичну поведінку;
   - чи вплинуло це на безпеку польоту.
3. Внести проблему до трекера / репозиторію або внутрішньої документації.
4. Внести зміни в код, оновити **changelog** та перепрошити плату.

---

Якщо у вас є власні повторювані питання або специфічні сценарії, які тут не описані, варто додати їх у цей розділ як окремі пункти FAQ — це сильно спростить життя майбутнім операторам та інженерам.
