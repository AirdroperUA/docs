---
id: gnss_security_model
title: Модель загроз та обмеження плати
sidebar_label: Модель загроз
---

Ця сторінка описує, **від чого саме захищає** плата **GNSS sanity board на STM32F401**, а також її **обмеження**. Важливо розуміти, що це не “чарівний щит від усіх атак”, а один з елементів багаторівневого захисту навігації.


---

## 1. Які загрози плата допомагає виявляти

Плата орієнтована на виявлення **грубих та середньої складності аномалій** у сигналі GNSS, які типово виникають при:

- примітивному або “неакуратному” спуфінгу;
- помилках або збоях GNSS-приймача;
- помилках конфігурації.

### 1.1. Різкі стрибки координат (телепорти)

Якщо між двома послідовними вимірами відбувся надто великий стрибок відстані (`GNSS_MAX_DIST_JUMP_M`), плата:

- вважає це **аномалією**;
- переходить у режим **DR1** (Dead Reckoning);
- заморожує або відкидає підозрілі координати;
- генерує `STATUSTEXT` про вхід у DR.

Це захищає від типового сценарію, коли спуфер **миттєво переносить UAV на десятки/сотні кілометрів**.

---

### 1.2. Нереалістична швидкість / прискорення

Параметри `GNSS_MAX_SPEED_MPS` та `GNSS_MAX_SPEED_JUMP` задають:

- максимально допустиму **швидкість** UAV (з урахуванням класу платформи);
- максимально допустимий **ривок швидкості** між вимірами.

Якщо GNSS раптом показує:

- швидкість, яка фізично неможлива для вашого UAV;
- дуже різкий ривок (наприклад з 20 до 300 м/с за 1 секунду),

плата розцінює це як спуфінг/помилку і переходить у DR.

---

### 1.3. Телепорт у інший регіон / півкулю

У прошивці є логіка, що відстежує:

- стрибок координат на надмірну відстань;
- перехід з Північної півкулі в Південну за один апдейт.

Сценарій:

- UAV летить в Україні;
- GNSS раптово показує координати десь в Південній Америці / Австралії;
- плата розпізнає це як **безумовний спуфінг** і негайно входить у DR.

---

### 1.4. Довга відсутність нормального fix / поганий сигнал

Якщо GNSS тривалий час:

- не може отримати 3D-fix;
- дає дуже малу кількість супутників;
- показує HDOP набагато гірший за поріг (`GNSS_MAX_HDOP_GOOD`);

плата розцінює це як **ненадійний GNSS** і також може перейти в DR.

Це захищає від ситуацій, коли:

- GNSS глушиться (`jamming`);
- приймач “залипає” в дивному стані з псевдо-fix (0 супутників, але фікс);

але важливо розуміти, що плата в такому випадку **не знає справжніх координат**, вона лише **не дозволяє автопілоту довіряти фейковим**.

---

## 2. Що плата не може робити

### 2.1. Захист від повільного, високоточного спуфінгу

Якщо атакуючий:

- повільно зміщує координати;
- зберігає реалістичну швидкість, прискорення, HDOP, кількість супутників;

плата **може не виявити** таку атаку, тому що:

- всі параметри залишаються в межах фізично можливих;
- немає різких телепортів чи аномальних ривків.

У такій ситуації потрібно використовувати **інші джерела навігації**:

- INS (інерціальна навігація);
- барометр, повітряна швидкість;
- візуальна навігація (наприклад, VIO / SLAM);
- порівняння з вторинним GNSS (іншої архітектури / провайдера).

---

### 2.2. Повноцінний захист від jamming

Якщо сигнал GNSS **повністю заглушений** (jamming):

- плата бачить тільки те, що бачить GNSS-приймач;
- вона не може “вигадати” правильні координати.

У цьому випадку плата:

- визначає, що GNSS “помер” (немає fix, супутників, адекватних даних);
- переходить у DR і **не дає автопілоту приймати випадковий шум за координати**.

Але:

- вона **не повертає навігацію**;
- потрібні інші джерела позиції (INS, “мертва навігація” автопілота, інші сенсори).

---

### 2.3. Захист від компрометації автопілота / конфігурації

Плата **не захищає** від ситуацій, коли:

- автопілот некоректно налаштований (наприклад, `GPS_TYPE` або `EKF` змінені небезпечно);
- код автопілота модифіковано атакуючим;
- хтось вручну відключив згадану плату у конфігурації.

GNSS sanity board контролює лише **ланцюжок GNSS → MAVLink GPS**, але не обмежує:

- логіку обробки GPS-даних всередині автопілота;
- інші канали, через які в автопілот можна ввести фейкову позицію (HIL, GCS, інші MAVLink-сообщення).

---

### 2.4. Фізична безпека (sabotage hardware)

Плата не захищає від:

- фізичного втручання в проводку (перепідключення GNSS напряму до автопілота, обхід плати);
- заміни самої плати на модифіковану (якщо немає контролю версій/цілісності).

Тут потрібні організаційні заходи:

- пломбування конекторів;
- контроль цілісності;
- регламент обслуговування.

---

## 3. Рекомендована стратегія “захисту шар за шаром”

GNSS sanity board має працювати **разом з іншими шарами захисту**, а не замість них. Рекомендації:

### 3.1. Два джерела GPS

- Основний GNSS-приймач через плату (фільтрований GPS).
- Другий GPS (можливо від іншого провайдера / з іншою антеною / архітектурою) напряму до автопілота.

У такому випадку:

- плата допомагає фільтрувати грубі аномалії;
- автопілот може порівнювати дані двох незалежних джерел.

---

### 3.2. Інші сенсори для перевірки реальності руху

Рекомендується мати:

- **IMU / INS** (стандартно є на автопілоті) — використовується EKF;
- **барометр** — для контролю висоти;
- **airspeed** — для перевірки фізично можливої швидкості;
- (опційно) **візуальні сенсори** (камери, оптичний потік, VIO).

Якщо GPS раптово “каже”, що UAV летить 200 м/с, а по airspeed і IMU видно ~25–30 м/с — це додатковий сигнал про спуфінг, який може бути використаний в логіці автопілота.

---

### 3.3. Грамотна конфігурація ArduPilot

- Використовуйте `GPS_TYPE = MAV` / `GPS_TYPE2` так, як описано в розділі інтеграції.
- Коректно налаштуйте EKF (джерела POSXY/POSZ/VN/VY, `GPS_CHECK`, `GPS_AUTO_SWITCH`).
- Увімкніть логування повідомлень `STATUSTEXT`, GPS, EKF.

---

### 3.4. Моніторинг логів та регулярні тести

- Після кожних змін прошивки/конфігурації виконуйте **lab-тести** (див. відповідний розділ).
- Регулярно аналізуйте **USB-логи плати** та **.bin-логи автопілота**.
- Проводьте періодичні імітації проблем з GNSS (в межах дозволеного) і дивіться, як реагує система.

---

## 4. Як адаптувати пороги під ваш сценарій

Параметри на кшталт:

- `GNSS_MAX_DIST_JUMP_M`;
- `GNSS_MAX_SPEED_MPS`;
- `GNSS_MAX_ALT_JUMP_M`;
- `GNSS_MIN_SATS_FIX`, `GNSS_MIN_SATS_GOOD`;
- `GNSS_MAX_HDOP_GOOD`;
- `DR_ENTER_MIN_BAD_MS`, `DR_EXIT_MIN_GOOD_MS`;

мають бути підібрані **під конкретний клас UAV та профіль польотів**.

### 4.1. Приклади

- Для повільного пінопластового крила (20–30 м/с):
  - `GNSS_MAX_SPEED_MPS` може бути 60–80 м/с;
  - `GNSS_MAX_DIST_JUMP_M` — 100–150 м;
  - чутливіші пороги виявлення спуфінгу.

- Для швидкісної платформи (100+ м/с):
  - `GNSS_MAX_SPEED_MPS` збільшується відповідно;
  - `GNSS_MAX_DIST_JUMP_M` має враховувати реальний максимум за 1–2 секунди.

> Важливо: занадто жорсткі пороги можуть приводити до **частих false positive** (зайві входи в DR), занадто мʼякі — до пропуску атак.

---

## 5. Підсумок: що реально дає плата

Плата **GNSS sanity board**:

- допомагає **відкидати явно фейкові / фізично неможливі** GPS-дані;
- захищає від грубого спуфінгу, телепортів, дивних стрибків швидкості/висоти;
- переводить автопілот у режим без GPS (DR), замість того, щоб дозволити йому “повірити” у маячню.

Але вона **не може**:

- повернути навігацію при повному глушінні GNSS;
- гарантовано виявляти “ідеальний” повільний спуфінг;
- виправити неправильну конфігурацію автопілота або відсутність інших сенсорів.

Тому плата розглядається як **важливий, але не єдиний** компонент системи захисту, і її ефективність максимальна тільки в комбінації з:

- правильно налаштованим ArduPilot;
- додатковими сенсорами;
- другою навігаційною системою (другий GNSS, INS, візуальна навігація);
- регулярними тестами та аналізом логів.
